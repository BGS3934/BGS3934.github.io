name: Generate Index

on:
  push:
    branches:
      - main  # Change to your default branch if different

jobs:
  update-index:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Generate index.html
        run: |
          # Start the index.html file
          echo '<!DOCTYPE html><html lang="en">' > index.html
          echo '<head><meta charset="UTF-8"><title>Student Projects</title></head>' >> index.html
          echo '<body><h1>Student Projects</h1><ul>' >> index.html

          # Loop through each subfolder in the root directory
          for dir in $(find . -type d -mindepth 1 -maxdepth 1); do
            student=$(basename "$dir")
            if [ -f "$dir/index.html" ]; then
              # Add each project as a list item with a link
              echo "<li><a href='${student}/index.html'>${student}'s Project</a></li>" >> index.html
            fi
          done

          # Close the HTML tags
          echo '</ul></body></html>' >> index.html

      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add index.html
          git commit -m "Update index.html with project links"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
